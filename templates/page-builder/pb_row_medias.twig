{% extends is_shortcode ? 'shortcode/pb_wrapper.twig' : 'page-builder/pb_row_wrapper.twig' %}

{% set index = index|default('pb-row-medias-' ~ random(1, 10000)) %}
{% set classname = classname|default('') %}
{% set attributes = attributes|default([]) %}

{% set medias = post.medias %}
{% set layout = post.layout|default('slider') %}
{% set format = post.format|default('square') %}
{% set grid_gap = post.grid_gap|default(3) %}
{% set fullwidth = post.fullwidth|default(false) %}

{% set classname = classname ~ ' --layout-' ~ layout %}

{% if layout == 'slider' %}
  {% set attributes = attributes|merge([
    'data-module="pb-row-medias"',
    'data-pb-row-medias'
  ]) %}
{% endif %}

{% block row_wrapper %}
{% if medias %}

<div
  id="{{ index }}"
  class="pb-row pb-row-medias {{ classname }}"
  {% if layout in ['slider', 'grid'] %}
  data-scroll
  data-scroll-offset="100px,0"
  {% endif %}
  {{ attributes|join(' ') }}
>
  {% if layout == 'slider' %}
  <div class="pb-row-medias__slider swiper-container">
    <aside 
      class="pb-row-medias__nav container-fluid d-flex align-items-center justify-content-end"
      aria-hidden="true"
    >
      {% include 'partial/button.twig' with {
        'title': 'Précédent',
        'style': 'arrow',
        'variation': 'left',
        'classname': 'pb-row-medias__prev'
      } only %}

      {% include 'partial/button.twig' with {
        'title': 'Suivant',
        'style': 'arrow',
        'classname': 'pb-row-medias__next'
      } only %}

    </aside>

    <div class="swiper-wrapper">
      {% for media in medias if media.image %}
      <div class="pb-row-medias__slide pb-row-medias__media swiper-slide">
        <figure class="pb-row-medias__wrap d-block m-0 p-0">
          <div class="pb-row-medias__box overflow-hidden">
            {% include 'partial/image.twig' with {
              'image': Image(media.image),
              'classname': 'pb-row-medias__img'
            } only %}
          </div>

          {% if media.credit %}
          <figcaption class="pb-row-medias__caption d-block m-0 p-0">{{ media.credit }}</figcaption>
          {% endif %}
        </figure>
      </div>
      {% endfor %}
    </div>
  </div>

  {% else %}

  <div class="pb-row-medias__grid d-grid grid-gap-{{ grid_gap }} {% if fullwidth %}--fullwidth{% endif %}">
    {% for media in medias if media.image %}
    {% set image = Image(media.image) %}
    <div 
      class="pb-row-medias__media"
      data-scroll
      data-scroll-offset="100px,0"
    >
      <figure 
        id="{{ index ~ '_' ~ loop.index }}"
        class="pb-row-medias__box box box-{{ format }} overflow-hidden"
      >
        <div 
          class="pb-row-medias__parallax position-absolute t-0 l-0 r-0 b-0"
          data-scroll
          data-scroll-target="#{{ index ~ '_' ~ loop.index }}"
          data-scroll-speed="0.5"
        >
          {% include 'partial/image.twig' with {
            'image': image,
            'classname': 'pb-row-medias__img image-as-background'
          } only %}
        </div>

        {% if media.credit %}
        <figcaption class="pb-row-medias__caption d-block m-0 p-0">{{ media.credit }}</figcaption>
        {% endif %}
      </figure>
    </div>
    {% endfor %}
  </div>
  
  {% endif %}

</div>

{% endif %}
{% endblock %}
